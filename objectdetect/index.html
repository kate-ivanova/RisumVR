<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Image Example</title>

	<script src="./js/jquery.js"></script>
	<script src="./js/objectdetect.js"></script>
	<script src="./js/objectdetect.frontalface.js"></script>
	<script src="./js/objectdetect.profileface.js"></script>
	<script src="./js/objectdetect.mouth.js"></script>
	<script src="./js/objectdetect.eye.js"></script>
	<script src="./js/objectdetect.nose.js"></script>
</head>

<body>
	<h1>Detect Faces</h1>
	<video id='myVideo' width="400" height="300"></video>
	<canvas id="myCanvas" width="400" height="300"></canvas>
<script>
	navigator.getUserMedia = navigator.getUserMedia ||
											 navigator.webkitGetUserMedia ||
											 navigator.mozGetUserMedia;

	if (navigator.getUserMedia) {
	 navigator.getUserMedia({ video: { width: 400, height: 300 } },
			function(stream) {
				 var video = $('#myVideo').get(0);
				 video.srcObject = stream;
				 video.onloadedmetadata = function(e) {
					 video.play();
				 };
			},
			function(err) {
				 console.log("The following error occurred: " + err.name);
			}
	 );
	}
</script>
<script>
window.onload = function() {
	var canvas = document.getElementById('myCanvas');
	var context = canvas.getContext('2d');
	var detector;
	var classifier = objectdetect.mouth;

	function detectFaces(canvas) {
		// Detect faces in the image:
		var rects = detector.detect(canvas);

		// Draw rectangles around detected faces:
		for (var i = 0; i < rects.length; ++i) {
			var coord = rects[i];
			context.beginPath();
			context.lineWidth = 1;
			context.strokeStyle = 'rgba(0, 255, 255, 0.75)';
			context.rect(coord[0], coord[1], coord[2], coord[3]);
			context.stroke();
		}
	}

	function loadImage(src) {
		image = new Image();
		image.crossOrigin = "Anonymous";
		image.onload = function() {
			canvas.width = ~~(size * image.width / image.height);
			canvas.height = ~~(size);
			canvas.getContext('2d').drawImage(image, 0, 0, canvas.width, canvas.height);
			detector = new objectdetect.detector(canvas.width, canvas.height, 1.2, classifier);
			detectFaces(canvas);
		}

		image.src = src;
	}

	function handleFileSelect(e) {
			var file = e.target.files[0];
		var reader = new FileReader();

		reader.onload = function(e) {
			loadImage(e.target.result);
		};
		reader.readAsDataURL(file);
	}

	function handleClassifierSelect(e) {
		classifier = objectdetect[e.target.value];
		detector = new objectdetect.detector(canvas.width, canvas.height, 1.2, classifier);
		canvas.getContext('2d').drawImage(image, 0, 0, canvas.width, canvas.height);
		detectFaces(canvas);
	}
	document.getElementById('file').addEventListener('change', handleFileSelect, false);
	document.getElementById('select').addEventListener('change', handleClassifierSelect, false);
}
</script>
</body>
</html>
